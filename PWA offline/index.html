<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Catalog</title>
    <!-- Link to the Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Theme color for browser UI -->
    <meta name="theme-color" content="#4a90e2">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A simple transition for better UX */
        .list-item {
            transition: background-color 0.2s ease-in-out;
        }
        .list-item:hover {
            background-color: #f0f4f8;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4 max-w-lg">
        <!-- Header -->
        <header class="bg-blue-600 text-white p-4 rounded-lg shadow-md mb-6">
            <h1 class="text-2xl font-bold">Employee Catalog</h1>
            <p class="text-sm">A Simple CRUD PWA</p>
        </header>

        <!-- Form for C.R.U.D operations -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4" id="form-title">Add New Employee</h2>
            <form id="employee-form">
                <!-- Hidden input for tracking the ID of the employee being edited -->
                <input type="hidden" id="employee-id">
                <div class="mb-4">
                    <label for="name" class="block text-gray-700 font-medium">Name</label>
                    <input type="text" id="name" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., Jane Doe" required>
                </div>
                <div class="mb-4">
                    <label for="position" class="block text-gray-700 font-medium">Position</label>
                    <input type="text" id="position" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., Team Leader" required>
                </div>
                <div class="flex items-center space-x-2">
                    <button type="submit" id="submit-button" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">Add Employee</button>
                    <button type="button" id="cancel-button" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 hidden">Cancel</button>
                </div>
            </form>
        </div>

        <!-- List of employees -->
        <div class="bg-white rounded-lg shadow-md">
             <h2 class="text-xl font-semibold p-4 border-b">Current Employees</h2>
            <ul id="employee-list" class="divide-y divide-gray-200">
                <!-- Employee items will be injected here by JavaScript -->
            </ul>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const employeeForm = document.getElementById('employee-form');
        const employeeIdInput = document.getElementById('employee-id');
        const nameInput = document.getElementById('name');
        const positionInput = document.getElementById('position');
        const employeeList = document.getElementById('employee-list');
        const formTitle = document.getElementById('form-title');
        const submitButton = document.getElementById('submit-button');
        const cancelButton = document.getElementById('cancel-button');

        // --- State ---
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let isEditing = false;

        // --- Functions ---

        // RENDER: Display employees in the list
        function renderEmployees() {
            employeeList.innerHTML = ''; // Clear the list first
            if (employees.length === 0) {
                 employeeList.innerHTML = `<li class="p-4 text-center text-gray-500">No employees found. Add one above!</li>`;
                 return;
            }
            employees.forEach(employee => {
                const li = document.createElement('li');
                li.className = 'p-4 flex justify-between items-center list-item';
                li.innerHTML = `
                    <div>
                        <p class="font-semibold text-lg">${employee.name}</p>
                        <p class="text-gray-600">${employee.position}</p>
                    </div>
                    <div class="space-x-2">
                        <button onclick="editEmployee('${employee.id}')" class="text-blue-500 hover:text-blue-700 font-medium">Edit</button>
                        <button onclick="deleteEmployee('${employee.id}')" class="text-red-500 hover:text-red-700 font-medium">Delete</button>
                    </div>
                `;
                employeeList.appendChild(li);
            });
        }

        // SAVE: Persist employees to localStorage
        function saveEmployees() {
            localStorage.setItem('employees', JSON.stringify(employees));
        }

        // CREATE / UPDATE: Handle form submission
        employeeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = nameInput.value.trim();
            const position = positionInput.value.trim();
            const id = employeeIdInput.value;

            if (isEditing) {
                // Update existing employee
                const index = employees.findIndex(emp => emp.id === id);
                if (index > -1) {
                    employees[index].name = name;
                    employees[index].position = position;
                }
            } else {
                // Add new employee
                const newEmployee = {
                    id: Date.now().toString(), // Simple unique ID
                    name: name,
                    position: position
                };
                employees.push(newEmployee);
            }

            saveEmployees();
            renderEmployees();
            resetForm();
        });

        // EDIT: Populate form for editing
        window.editEmployee = function(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            isEditing = true;
            employeeIdInput.value = employee.id;
            nameInput.value = employee.name;
            positionInput.value = employee.position;

            formTitle.textContent = 'Edit Employee';
            submitButton.textContent = 'Save Changes';
            cancelButton.classList.remove('hidden');
            window.scrollTo(0, 0); // Scroll to top to see the form
        }

        // DELETE: Remove an employee
        window.deleteEmployee = function(id) {
            if (confirm('Are you sure you want to delete this employee?')) {
                employees = employees.filter(emp => emp.id !== id);
                saveEmployees();
                renderEmployees();
            }
        }
        
        // Reset the form to its initial state
        function resetForm() {
            employeeForm.reset();
            employeeIdInput.value = '';
            isEditing = false;
            formTitle.textContent = 'Add New Employee';
            submitButton.textContent = 'Add Employee';
            cancelButton.classList.add('hidden');
        }
        
        // Listen for cancel button click
        cancelButton.addEventListener('click', resetForm);

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            renderEmployees();

            // Register the Service Worker for PWA functionality
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            }
        });

    </script>
</body>
</html>
